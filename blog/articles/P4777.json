{"title":"P4777 【模板】扩展中国剩余定理（EXCRT）","file":"P4777.json","pic":"/bg/33.jpg","tag":["exgcd","excrt"],"priority":0,"source":"LG","link":[["LG","https://www.luogu.com.cn/problem/P4777"]],"pswd":false,"date":"2021-06-28 19:09","content":"## 题目描述\n\n给定  $n$ 组非负整数  $a_i, b_i$ ，求解关于  $x$ 的方程组的最小非负整数解。\n$$\\begin{cases} x \\equiv b_1\\ ({\\rm mod}\\ a_1) \\\\ x\\equiv b_2\\ ({\\rm mod}\\ a_2) \\\\ ... \\\\ x \\equiv b_n\\ ({\\rm mod}\\ a_n)\\end{cases}$$\n\n## 输入格式\n\n输入第一行包含整数 $n$。\n\n接下来 $n$ 行，每行两个非负整数 $a_i, b_i$。\n\n## 输出格式\n\n输出一行，为满足条件的最小非负整数 $x$。\n\n## 提示\n\n对于 $100 \\%$ 的数据，$1 \\le n \\le {10}^5$，$1 \\le b_i,a_i \\le {10}^{12}$，保证所有 $a_i$ 的最小公倍数不超过 ${10}^{18}$。\n\n**请注意程序运行过程中进行乘法运算时结果可能有溢出的风险。**\n\n数据保证有解。\n\n## 题解\n$$\n\\begin{cases}\nx \\equiv a_1\\ \\pmod{b_1}\\\\\nx \\equiv a_1\\ \\pmod{b_1}\\\\\n\\dots\\\\\nx \\equiv a_1\\ \\pmod{b_1}\\\\\n\\end{cases}\n$$\n\n\n\n如果知道了前 $k-1$ 个方程的解 $x$，记 $m=\\operatorname{lcm}_{i=1}^{k-1}b_i$ ，那么 $x+i\\times m(i\\in\\mathbb{Z})$ 是前 $k-1$ 的通解。于是考虑合并第 $k$ 个方程。要求：\n$$\nx+t\\times m\\equiv a_i\\pmod{b_i}\\\\\nx'=x+t\\times m\n$$\n于是就相当于求方程 $x+t\\times m\\equiv a_i\\pmod{b_i}$，$\\rm exgcd$ 一下就好了。\n\n## 代码\n```cpp\n#include<bits/stdc++.h>\n#define mp make_pair\n#define mt make_tuple\n#define eb emplace_back\n#define pb push_back\n#define pc putchar\n#define chkmx(a,b) (a)=max((a),(b))\n#define chkmn(a,b) (a)=min((a),(b))\n#define fi first\n#define se second\nusing namespace std;\ntemplate<class T>\nvoid read(T&x){x=0;char c=getchar();bool f=0;for(;!isdigit(c);c=getchar())f^=c=='-';for(;isdigit(c);c=getchar())x=x*10+c-'0';if(f)x=-x;}\ntemplate<class T,class ...ARK>void read(T&x,ARK&...ark){read(x);read(ark...);}\ntemplate<class T>void write(T x){if(x<0)pc('-'),x=-x;if(x>=10)write(x/10);pc(x%10+'0');}\ntemplate<class T,class ...ARK>void write(T x,ARK...ark){write(x);pc(' ');write(ark...);}\ntemplate<class ...ARK>void writeln(ARK...ark){write(ark...);pc('\\n');}\ntypedef __int128 ll;\nconst int N=100000+10;\nint n;\nll a[N],b[N],ans,M,x,y;\nll ksc(ll n,ll k,ll mod){\n\tll ans=0;\n\twhile(k){\n\t\tif(k&1)(ans+=n)%=mod;\n\t\tk>>=1;(n+=n)%=mod;\n\t}return ans;\n}\nll exgcd(ll a,ll b,ll&x,ll&y){\n\tif(!b){x=1,y=0;return a;}\n\tll d=exgcd(b,a%b,x,y);\n\tll z=x;x=y;y=z-(a/b)*y;\n\treturn d;\n}\nsigned main(){\n\tread(n);\n\tfor(int i=1;i<=n;i++)read(b[i],a[i]);\n\tans=a[1];M=b[1];\n\tfor(int i=2;i<=n;i++){\n\t\tll B=((a[i]-ans)%b[i]+b[i])%b[i];\n\t\tll GCD=exgcd(M,b[i],x,y);\n\t\tx=ksc(x,B/GCD,b[i]);\n\t\tans+=M*x;\n\t\tM*=b[i]/GCD;\n\t\tans=(ans+M)%M;\n\t}\n\twriteln(ans);\n}\n```\n"}